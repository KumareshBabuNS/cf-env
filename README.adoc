This is a small Java library for parsing the Cloud Foundry environment variables (VCAP_SERVICES and so on).

// the first line of this file is used as a description in the POM, so keep it short and sweet!

Download from Bintray:

image::https://api.bintray.com/packages/pivotal-labs-london/maven/cf-env/images/download.svg[link="https://bintray.com/pivotal-labs-london/maven/cf-env/_latestVersion"]

Use as a dependency in your build:

--------------------------------------
repositories {
    jcenter()
}

dependencies {
    compile group: 'io.pivotal.labs', name: 'cf-env', version: '0.0.1'
}
--------------------------------------

Incorporate into your application:

--------------------------------------
@WebServlet("/ini")
public class ServicesAsIniFileServlet extends HttpServlet {
    @Override
    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        CloudFoundryEnvironment environment;
        try {
            environment = new CloudFoundryEnvironment(System::getenv);
        } catch (CloudFoundryEnvironmentException e) {
            throw new ServletException(e);
        }

        response.setStatus(HttpServletResponse.SC_OK);
        response.setContentType("text/plain");

        try (PrintWriter out = response.getWriter()) {
            for (String serviceName : environment.getServiceNames()) {
                CloudFoundryService service = environment.getService(serviceName);
                out.println("[" + service.getName() + "]");
                out.println("label = " + service.getLabel());
                if (service.getPlan() != null) out.println("plan = " + service.getPlan());
                out.println("tags = " + service.getTags().stream().collect(Collectors.joining(", ")));
                Map<String, Object> credentials = service.getCredentials();
                credentials.forEach((name, value) -> out.println("credentials." + name + " = " + value));
                out.println();
            }
        }
    }
}
--------------------------------------

Build with Gradle:

--------------------------------------
./gradlew build
--------------------------------------

Release with Gradle:

--------------------------------------
# you probably want to make these changes manually rather than like this
sed -i -e "s/^version = .*/version = 'x.y.z'/" build.gradle
echo -e "bintrayUser=pivotal-labs-london\nbintrayKey=..." >gradle.properties

./gradlew bintrayUpload
--------------------------------------

Create some SSL keys and certificates for testing the certificate handling:

--------------------------------------
openssl req -x509 -newkey 512 -subj /OU=IAmACertificateAuthority -nodes -keyout ca.key -out ca.crt
openssl req -newkey 512 -subj /OU=IAmAService -nodes -keyout service.key -out service.csr
openssl x509 -req -in service.csr -CAkey ca.key -CA ca.crt -CAcreateserial -out service.crt
openssl pkcs8 -topk8 -in service.key -nocrypt -out service.key8
--------------------------------------
